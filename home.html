<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Instrument Shop Accounting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --background-color: #ecf0f1;
            --text-color: #34495e;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: bold;
            color: #fff !important;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8) !important;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover, .nav-link.active {
            color: #fff !important;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transition: background-color 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #27ae60;
            border-color: #27ae60;
        }
        
        #reportResults {
            background-color: #fff;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            border-radius: 10px;
        }
        
        .form-control, .form-select {
            border-radius: 20px;
            border: 1px solid #ced4da;
            padding: 0.5rem 1rem;
        }
        
        .input-group-text {
            border-top-left-radius: 20px;
            border-bottom-left-radius: 20px;
        }
        
        .tab-content {
            background-color: #fff;
            border-radius: 0 0 10px 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .nav-tabs {
            border-bottom: none;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--text-color);
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding: 0.75rem 1.5rem;
            transition: background-color 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .nav-tabs .nav-link.active {
            background-color: #fff;
            color: var(--primary-color) !important;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-mobile-alt me-2"></i>Mobile Instrument Shop Accounting
            </a>
            <div class="ms-auto" id="navbarNav">
                <ul class="navbar-nav">
                    <!-- Buttons will be inserted here -->
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="transactions-tab" data-bs-toggle="tab" data-bs-target="#transactions" type="button" role="tab">
                    <i class="fas fa-exchange-alt me-2"></i>Transactions
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="debts-credits-tab" data-bs-toggle="tab" data-bs-target="#debts-credits" type="button" role="tab">
                    <i class="fas fa-balance-scale me-2"></i>Debts & Credits
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="costs-tab" data-bs-toggle="tab" data-bs-target="#costs" type="button" role="tab">
                    <i class="fas fa-file-invoice-dollar me-2"></i>Costs
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab">
                    <i class="fas fa-chart-bar me-2"></i>Reports
                </button>
            </li>
        </ul>
        
        <div class="tab-content mt-0" id="myTabContent">
            <div class="tab-pane fade show active" id="transactions" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-exchange-alt me-2"></i>Register Buy and Sell Transactions
                    </div>
                    <div class="card-body">
                        <form id="transactionForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="transactionDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="transactionDate" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="productName" class="form-label">Product Name</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="price" class="form-label">Price</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="price" required>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="quantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="quantity" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="transactionType" class="form-label">Type</label>
                                    <select class="form-select" id="transactionType" required>
                                        <option value="buy">Buy</option>
                                        <option value="sell">Sell</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Submit
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="debts-credits" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-balance-scale me-2"></i>Register Debts and Credits
                    </div>
                    <div class="card-body">
                        <form id="debtCreditForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="personName" class="form-label">Name of Person</label>
                                    <input type="text" class="form-control" id="personName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="amount" class="form-label">Amount</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="amount" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="paymentDate" class="form-label">Date of Payment</label>
                                    <input type="date" class="form-control" id="paymentDate" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="debtCreditType" class="form-label">Type</label>
                                    <select class="form-select" id="debtCreditType" required>
                                        <option value="debt">Debt</option>
                                        <option value="credit">Credit</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Submit
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="costs" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-file-invoice-dollar me-2"></i>Register Costs
                    </div>
                    <div class="card-body">
                        <form id="costForm">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="costType" class="form-label">Cost Type</label>
                                    <select class="form-select" id="costType" required>
                                        <option value="rent">Rent</option>
                                        <option value="electricity">Electricity</option>
                                        <option value="water">Water</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="costAmount" class="form-label">Amount</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="costAmount" required>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="costDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="costDate" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Submit
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="reports" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-bar me-2"></i>Generate Reports
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="reportType" class="form-label">Report Type</label>
                                <select class="form-select" id="reportType">
                                    <option value="weekly">Weekly Report</option>
                                    <option value="monthly">Monthly Report</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">&nbsp;</label>
                                <button id="generateReport" class="btn btn-primary d-block">
                                    <i class="fas fa-file-alt me-2"></i>Generate Report
                                </button>
                            </div>
                        </div>
                        <div id="reportResults" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Initialize an object to store our data
            let shopData = {
                transactions: [],
                debtsCredits: [],
                costs: []
            };

            // Load data when the page loads
            loadData();

            // Handle transaction form submission
            $('#transactionForm').submit(function(e) {
                e.preventDefault();
                let transaction = {
                    date: $('#transactionDate').val(),
                    productName: $('#productName').val(),
                    price: parseFloat($('#price').val()),
                    quantity: parseInt($('#quantity').val()),
                    type: $('#transactionType').val()
                };
                shopData.transactions.push(transaction);
                this.reset();
                showAlert('Transaction added successfully!', 'success');
            });

            // Handle debt/credit form submission
            $('#debtCreditForm').submit(function(e) {
                e.preventDefault();
                let debtCredit = {
                    personName: $('#personName').val(),
                    amount: parseFloat($('#amount').val()),
                    paymentDate: $('#paymentDate').val(),
                    type: $('#debtCreditType').val()
                };
                shopData.debtsCredits.push(debtCredit);
                this.reset();
                showAlert('Debt/Credit entry added successfully!', 'success');
            });

            // Handle cost form submission
            $('#costForm').submit(function(e) {
                e.preventDefault();
                let cost = {
                    type: $('#costType').val(),
                    amount: parseFloat($('#costAmount').val()),
                    date: $('#costDate').val()
                };
                shopData.costs.push(cost);
                this.reset();
                showAlert('Cost entry added successfully!', 'success');
            });

            // Generate report
            $('#generateReport').click(function() {
                let reportType = $('#reportType').val();
                let report = generateReport(reportType);
                $('#reportResults').html(report);
            });

            // Modified Save data to JSON file function
            function saveData() {
                // First, load existing data
                let fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                fileInput.onchange = function(e) {
                    let file = e.target.files[0];
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            let existingData = JSON.parse(e.target.result);
                            // Merge existing data with current shopData
                            let mergedData = {
                                transactions: [...existingData.transactions, ...shopData.transactions],
                                debtsCredits: [...existingData.debtsCredits, ...shopData.debtsCredits],
                                costs: [...existingData.costs, ...shopData.costs]
                            };
                            
                            // Save merged data
                            let jsonData = JSON.stringify(mergedData, null, 2);
                            let blob = new Blob([jsonData], {type: "application/json"});
                            saveAs(blob, "shop_data.json");
                            showAlert('Data saved successfully!', 'success');
                            
                            // Update shopData with merged data
                            shopData = mergedData;
                        } catch (error) {
                            // If there's an error parsing the file (e.g., it's empty or invalid),
                            // just save the current shopData
                            let jsonData = JSON.stringify(shopData, null, 2);
                            let blob = new Blob([jsonData], {type: "application/json"});
                            saveAs(blob, "shop_data.json");
                            showAlert('New data saved successfully!', 'success');
                        }
                    };
                    reader.readAsText(file);
                };
                fileInput.click();
            }

            // Load data from JSON file
            function loadData() {
                let fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                fileInput.onchange = function(e) {
                    let file = e.target.files[0];
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            shopData = JSON.parse(e.target.result);
                            showAlert('Data loaded successfully!', 'success');
                        } catch (error) {
                            showAlert('Error loading data: ' + error.message, 'danger');
                        }
                    };
                    reader.readAsText(file);
                };
                fileInput.click();
            }

            // Show alert function
            function showAlert(message, type) {
                const alertDiv = $('<div>').addClass(`alert alert-${type} alert-dismissible fade show`)
                    .attr('role', 'alert')
                    .html(`
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    `);
                $('body').append(alertDiv);
                setTimeout(() => {
                    alertDiv.alert('close');
                }, 3000);
            }

            // Generate report function
            function generateReport(type) {
                let now = new Date();
                let startDate = new Date();
                if (type === 'weekly') {
                    startDate.setDate(now.getDate() - 7);
                } else if (type === 'monthly') {
                    startDate.setMonth(now.getMonth() - 1);
                }

                let buySum = 0;
                let sellSum = 0;
                let debtSum = 0;
                let creditSum = 0;
                let costSum = 0;

                shopData.transactions.forEach(t => {
                    if (new Date(t.date) >= startDate) {
                        if (t.type === 'buy') {
                            buySum += t.price * t.quantity;
                        } else {
                            sellSum += t.price * t.quantity;
                        }
                    }
                });

                shopData.debtsCredits.forEach(dc => {
                    if (new Date(dc.paymentDate) >= startDate) {
                        if (dc.type === 'debt') {
                            debtSum += dc.amount;
                        } else {
                            creditSum += dc.amount;
                        }
                    }
                });

                shopData.costs.forEach(c => {
                    if (new Date(c.date) >= startDate) {
                        costSum += c.amount;
                    }
                });

                let profit = sellSum - buySum - costSum;

                return `
                    <h3 class="mb-4">${type.charAt(0).toUpperCase() + type.slice(1)} Report</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Transactions</h5>
                            <p>Total Purchases: $${buySum.toFixed(2)}</p>
                            <p>Total Sales: $${sellSum.toFixed(2)}</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Debts and Credits</h5>
                            <p>Total Debts: $${debtSum.toFixed(2)}</p>
                            <p>Total Credits: $${creditSum.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h5>Costs</h5>
                            <p>Total Costs: $${costSum.toFixed(2)}</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Profit</h5>
                            <p>Total Profit: $${profit.toFixed(2)}</p>
                        </div>
                    </div>
                `;
            }

            // Modify the button adding code at the end of the $(document).ready function
            $('<li class="nav-item">')
                .append($('<button>')
                    .text('Save Data')
                    .addClass('btn btn-success me-2')
                    .click(saveData))
                .appendTo('.navbar-nav');

            $('<li class="nav-item">')
                .append($('<button>')
                    .text('Load Data')
                    .addClass('btn btn-primary')
                    .click(loadData))
                .appendTo('.navbar-nav');
        });
    </script>

</body>
</html>    